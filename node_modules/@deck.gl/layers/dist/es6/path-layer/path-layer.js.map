{"version":3,"sources":["../../../src/path-layer/path-layer.js"],"names":["Layer","GL","Model","Geometry","fp64","fp64LowPart","vs","vs64","fs","DEFAULT_COLOR","defaultProps","widthScale","type","min","value","widthMinPixels","widthMaxPixels","Number","MAX_SAFE_INTEGER","rounded","miterLimit","dashJustified","getPath","object","path","getColor","getWidth","getDashArray","isClosed","firstPoint","lastPoint","length","ATTRIBUTE_TRANSITION","enter","chunk","subarray","PathLayer","getShaders","use64bitProjection","modules","initializeState","attributeManager","getAttributeManager","addInstanced","instanceStartPositions","size","transition","accessor","update","calculateStartPositions","instanceEndPositions","calculateEndPositions","instanceStartEndPositions64xyLow","calculateInstanceStartEndPositions64xyLow","instanceLeftDeltas","calculateLeftDeltas","instanceRightDeltas","calculateRightDeltas","instanceStrokeWidths","calculateStrokeWidths","defaultValue","instanceDashArrays","calculateDashArrays","instanceColors","UNSIGNED_BYTE","calculateColors","instancePickingColors","calculatePickingColors","updateState","oldProps","props","changeFlags","gl","context","state","model","delete","setState","_getModel","invalidateAll","geometryChanged","dataChanged","updateTriggersChanged","all","paths","data","push","bufferLayout","map","numInstances","reduce","count","segments","draw","uniforms","render","Object","assign","jointType","alignMode","SEGMENT_INDICES","SEGMENT_POSITIONS","id","geometry","drawMode","TRIANGLES","attributes","indices","Uint16Array","positions","Float32Array","isInstanced","shaderCache","_getPathLength","attribute","i","forEach","numSegments","ptIndex","point","isFP64","use64bitPositions","constant","startPoint","endPoint","prevPoint","nextPoint","index","width","pathLength","dashArray","pointColor","isNaN","pickingColor","encodePickingColor","layerName"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {Layer} from '@deck.gl/core';\nimport GL from 'luma.gl/constants';\nimport {Model, Geometry, fp64} from 'luma.gl';\nconst {fp64LowPart} = fp64;\n\nimport vs from './path-layer-vertex.glsl';\nimport vs64 from './path-layer-vertex-64.glsl';\nimport fs from './path-layer-fragment.glsl';\n\nconst DEFAULT_COLOR = [0, 0, 0, 255];\n\nconst defaultProps = {\n  widthScale: {type: 'number', min: 0, value: 1}, // stroke width in meters\n  widthMinPixels: {type: 'number', min: 0, value: 0}, //  min stroke width in pixels\n  widthMaxPixels: {type: 'number', min: 0, value: Number.MAX_SAFE_INTEGER}, // max stroke width in pixels\n  rounded: false,\n  miterLimit: {type: 'number', min: 0, value: 4},\n  fp64: false,\n  dashJustified: false,\n\n  getPath: {type: 'accessor', value: object => object.path},\n  getColor: {type: 'accessor', value: DEFAULT_COLOR},\n  getWidth: {type: 'accessor', value: 1},\n  getDashArray: {type: 'accessor', value: [0, 0]}\n};\n\nconst isClosed = path => {\n  const firstPoint = path[0];\n  const lastPoint = path[path.length - 1];\n  return (\n    firstPoint[0] === lastPoint[0] &&\n    firstPoint[1] === lastPoint[1] &&\n    firstPoint[2] === lastPoint[2]\n  );\n};\n\nconst ATTRIBUTE_TRANSITION = {\n  enter: (value, chunk) => {\n    return chunk.length ? chunk.subarray(chunk.length - value.length) : value;\n  }\n};\n\nexport default class PathLayer extends Layer {\n  getShaders() {\n    return this.use64bitProjection()\n      ? {vs: vs64, fs, modules: ['project64', 'picking']}\n      : {vs, fs, modules: ['picking']}; // 'project' module added by default.\n  }\n\n  initializeState() {\n    const attributeManager = this.getAttributeManager();\n    /* eslint-disable max-len */\n    attributeManager.addInstanced({\n      instanceStartPositions: {\n        size: 3,\n        transition: ATTRIBUTE_TRANSITION,\n        accessor: 'getPath',\n        update: this.calculateStartPositions\n      },\n      instanceEndPositions: {\n        size: 3,\n        transition: ATTRIBUTE_TRANSITION,\n        accessor: 'getPath',\n        update: this.calculateEndPositions\n      },\n      instanceStartEndPositions64xyLow: {\n        size: 4,\n        update: this.calculateInstanceStartEndPositions64xyLow\n      },\n      instanceLeftDeltas: {size: 3, update: this.calculateLeftDeltas},\n      instanceRightDeltas: {size: 3, update: this.calculateRightDeltas},\n      instanceStrokeWidths: {\n        size: 1,\n        accessor: 'getWidth',\n        transition: ATTRIBUTE_TRANSITION,\n        update: this.calculateStrokeWidths,\n        defaultValue: 1\n      },\n      instanceDashArrays: {size: 2, accessor: 'getDashArray', update: this.calculateDashArrays},\n      instanceColors: {\n        size: 4,\n        type: GL.UNSIGNED_BYTE,\n        accessor: 'getColor',\n        transition: ATTRIBUTE_TRANSITION,\n        update: this.calculateColors,\n        defaultValue: DEFAULT_COLOR\n      },\n      instancePickingColors: {size: 3, type: GL.UNSIGNED_BYTE, update: this.calculatePickingColors}\n    });\n    /* eslint-enable max-len */\n  }\n\n  updateState({oldProps, props, changeFlags}) {\n    super.updateState({props, oldProps, changeFlags});\n\n    const {getPath} = this.props;\n    const attributeManager = this.getAttributeManager();\n    if (props.fp64 !== oldProps.fp64) {\n      const {gl} = this.context;\n      if (this.state.model) {\n        this.state.model.delete();\n      }\n      this.setState({model: this._getModel(gl)});\n      attributeManager.invalidateAll();\n    }\n\n    const geometryChanged =\n      changeFlags.dataChanged ||\n      (changeFlags.updateTriggersChanged &&\n        (changeFlags.updateTriggersChanged.all || changeFlags.updateTriggersChanged.getPath));\n\n    if (geometryChanged) {\n      // this.state.paths only stores point positions in each path\n      const paths = [];\n      for (const object of props.data) {\n        paths.push(getPath(object));\n      }\n      const bufferLayout = paths.map(path => path.length - 1);\n      const numInstances = bufferLayout.reduce((count, segments) => count + segments, 0);\n\n      this.setState({\n        paths,\n        numInstances,\n        bufferLayout\n      });\n      attributeManager.invalidateAll();\n    }\n  }\n\n  draw({uniforms}) {\n    const {\n      rounded,\n      miterLimit,\n      widthScale,\n      widthMinPixels,\n      widthMaxPixels,\n      dashJustified\n    } = this.props;\n\n    this.state.model.render(\n      Object.assign({}, uniforms, {\n        jointType: Number(rounded),\n        alignMode: Number(dashJustified),\n        widthScale,\n        miterLimit,\n        widthMinPixels,\n        widthMaxPixels\n      })\n    );\n  }\n\n  _getModel(gl) {\n    /*\n     *       _\n     *        \"-_ 1                   3                       5\n     *     _     \"o---------------------o-------------------_-o\n     *       -   / \"\"--..__              '.             _.-' /\n     *   _     \"@- - - - - \"\"--..__- - - - x - - - -_.@'    /\n     *    \"-_  /                   \"\"--..__ '.  _,-` :     /\n     *       \"o----------------------------\"\"-o'    :     /\n     *      0,2                            4 / '.  :     /\n     *                                      /   '.:     /\n     *                                     /     :'.   /\n     *                                    /     :  ', /\n     *                                   /     :     o\n     */\n\n    const SEGMENT_INDICES = [\n      // start corner\n      0,\n      2,\n      1,\n      // body\n      1,\n      2,\n      4,\n      1,\n      4,\n      3,\n      // end corner\n      3,\n      4,\n      5\n    ];\n\n    // [0] position on segment - 0: start, 1: end\n    // [1] side of path - -1: left, 0: center, 1: right\n    // [2] role - 0: offset point 1: joint point\n    const SEGMENT_POSITIONS = [\n      // bevel start corner\n      0,\n      0,\n      1,\n      // start inner corner\n      0,\n      -1,\n      0,\n      // start outer corner\n      0,\n      1,\n      0,\n      // end inner corner\n      1,\n      -1,\n      0,\n      // end outer corner\n      1,\n      1,\n      0,\n      // bevel end corner\n      1,\n      0,\n      1\n    ];\n\n    return new Model(\n      gl,\n      Object.assign({}, this.getShaders(), {\n        id: this.props.id,\n        geometry: new Geometry({\n          drawMode: GL.TRIANGLES,\n          attributes: {\n            indices: new Uint16Array(SEGMENT_INDICES),\n            positions: new Float32Array(SEGMENT_POSITIONS)\n          }\n        }),\n        isInstanced: true,\n        shaderCache: this.context.shaderCache\n      })\n    );\n  }\n\n  // \"Experimental\" method indended to make it easier to support non-nested arrays in subclasses\n  _getPathLength(path) {\n    return path.length;\n  }\n\n  calculateStartPositions(attribute) {\n    const {paths, bufferLayout} = this.state;\n    const {value} = attribute;\n\n    attribute.bufferLayout = bufferLayout;\n\n    let i = 0;\n    paths.forEach(path => {\n      const numSegments = path.length - 1;\n      for (let ptIndex = 0; ptIndex < numSegments; ptIndex++) {\n        const point = path[ptIndex];\n        value[i++] = point[0];\n        value[i++] = point[1];\n        value[i++] = point[2] || 0;\n      }\n    });\n  }\n\n  calculateEndPositions(attribute) {\n    const {paths, bufferLayout} = this.state;\n    const {value} = attribute;\n\n    attribute.bufferLayout = bufferLayout;\n\n    let i = 0;\n    paths.forEach(path => {\n      for (let ptIndex = 1; ptIndex < path.length; ptIndex++) {\n        const point = path[ptIndex];\n        value[i++] = point[0];\n        value[i++] = point[1];\n        value[i++] = point[2] || 0;\n      }\n    });\n  }\n\n  calculateInstanceStartEndPositions64xyLow(attribute) {\n    const isFP64 = this.use64bitPositions();\n    attribute.constant = !isFP64;\n\n    if (!isFP64) {\n      attribute.value = new Float32Array(4);\n      return;\n    }\n\n    const {paths} = this.state;\n    const {value} = attribute;\n\n    let i = 0;\n    paths.forEach(path => {\n      const numSegments = path.length - 1;\n      for (let ptIndex = 0; ptIndex < numSegments; ptIndex++) {\n        const startPoint = path[ptIndex];\n        const endPoint = path[ptIndex + 1];\n        value[i++] = fp64LowPart(startPoint[0]);\n        value[i++] = fp64LowPart(startPoint[1]);\n        value[i++] = fp64LowPart(endPoint[0]);\n        value[i++] = fp64LowPart(endPoint[1]);\n      }\n    });\n  }\n\n  calculateLeftDeltas(attribute) {\n    const {paths} = this.state;\n    const {value} = attribute;\n\n    let i = 0;\n    paths.forEach(path => {\n      const numSegments = path.length - 1;\n      let prevPoint = isClosed(path) ? path[path.length - 2] : path[0];\n\n      for (let ptIndex = 0; ptIndex < numSegments; ptIndex++) {\n        const point = path[ptIndex];\n        value[i++] = point[0] - prevPoint[0];\n        value[i++] = point[1] - prevPoint[1];\n        value[i++] = point[2] - prevPoint[2] || 0;\n        prevPoint = point;\n      }\n    });\n  }\n\n  calculateRightDeltas(attribute) {\n    const {paths} = this.state;\n    const {value} = attribute;\n\n    let i = 0;\n    paths.forEach(path => {\n      for (let ptIndex = 1; ptIndex < path.length; ptIndex++) {\n        const point = path[ptIndex];\n        let nextPoint = path[ptIndex + 1];\n        if (!nextPoint) {\n          nextPoint = isClosed(path) ? path[1] : point;\n        }\n\n        value[i++] = nextPoint[0] - point[0];\n        value[i++] = nextPoint[1] - point[1];\n        value[i++] = nextPoint[2] - point[2] || 0;\n      }\n    });\n  }\n\n  calculateStrokeWidths(attribute) {\n    const {data, getWidth} = this.props;\n    const {paths, bufferLayout} = this.state;\n    const {value} = attribute;\n\n    attribute.bufferLayout = bufferLayout;\n\n    let i = 0;\n    paths.forEach((path, index) => {\n      const width = getWidth(data[index], index);\n\n      const pathLength = this._getPathLength(path);\n      for (let ptIndex = 1; ptIndex < pathLength; ptIndex++) {\n        value[i++] = width;\n      }\n    });\n  }\n\n  calculateDashArrays(attribute) {\n    const {data, getDashArray} = this.props;\n    if (!getDashArray) {\n      return;\n    }\n\n    const {paths} = this.state;\n    const {value} = attribute;\n    let i = 0;\n    paths.forEach((path, index) => {\n      const dashArray = getDashArray(data[index], index);\n\n      const pathLength = this._getPathLength(path);\n      for (let ptIndex = 1; ptIndex < pathLength; ptIndex++) {\n        value[i++] = dashArray[0];\n        value[i++] = dashArray[1];\n      }\n    });\n  }\n\n  calculateColors(attribute) {\n    const {data, getColor} = this.props;\n    const {paths, bufferLayout} = this.state;\n    const {value} = attribute;\n\n    attribute.bufferLayout = bufferLayout;\n\n    let i = 0;\n    paths.forEach((path, index) => {\n      const pointColor = getColor(data[index], index);\n      if (isNaN(pointColor[3])) {\n        pointColor[3] = 255;\n      }\n\n      const pathLength = this._getPathLength(path);\n      for (let ptIndex = 1; ptIndex < pathLength; ptIndex++) {\n        value[i++] = pointColor[0];\n        value[i++] = pointColor[1];\n        value[i++] = pointColor[2];\n        value[i++] = pointColor[3];\n      }\n    });\n  }\n\n  // Override the default picking colors calculation\n  calculatePickingColors(attribute) {\n    const {paths} = this.state;\n    const {value} = attribute;\n\n    let i = 0;\n    paths.forEach((path, index) => {\n      const pickingColor = this.encodePickingColor(index);\n\n      const pathLength = this._getPathLength(path);\n      for (let ptIndex = 1; ptIndex < pathLength; ptIndex++) {\n        value[i++] = pickingColor[0];\n        value[i++] = pickingColor[1];\n        value[i++] = pickingColor[2];\n      }\n    });\n  }\n}\n\nPathLayer.layerName = 'PathLayer';\nPathLayer.defaultProps = defaultProps;\n"],"file":"path-layer.js"}